<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>制作ランクシステム タイマー版</title>
<style>
body {
    font-family: Arial;
    text-align: center;
    background: #111;
    color: white;
}
.container {
    margin-top: 30px;
}
button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 5px;
}
.progress {
    width: 80%;
    height: 30px;
    background: #333;
    margin: 20px auto;
    border-radius: 20px;
}
.progress-bar {
    height: 100%;
    width: 0%;
    background: gold;
    border-radius: 20px;
}
#timer {
    font-size: 40px;
    margin-top: 20px;
}
</style>
</head>
<body>

<div class="container">
<h1>制作ランクシステム タイマー版</h1>

<p>累計時間: <span id="totalHours">0</span> h</p>
<p>現在のランク: <span id="rank">ブロンズ I</span></p>
<p>次のランクまで: <span id="nextRank">4</span> h</p>

<div id="timer">00:00:00</div>

<button onclick="addTime()">+30分</button>
<button onclick="startTimer()">スタート/一時停止</button>
<button onclick="resetTimer()">タイマーリセット</button>
<button onclick="resetData()">累計リセット</button>

<div class="progress">
<div class="progress-bar" id="progressBar"></div>
</div>

</div>

<script>
// ランク設定
const ranks = [
{ name: "ブロンズ I", hours: 0 },
{ name: "ブロンズ II", hours: 4 },
{ name: "ブロンズ III", hours: 11 },
{ name: "シルバー I", hours: 20 },
{ name: "シルバー II", hours: 29 },
{ name: "シルバー III", hours: 43 },
{ name: "ゴールド I", hours: 60 },
{ name: "ゴールド II", hours: 78 },
{ name: "ゴールド III", hours: 104 },
{ name: "プラチナ I", hours: 140 },
{ name: "プラチナ II", hours: 178 },
{ name: "プラチナ III", hours: 232 },
{ name: "ダイヤモンド I", hours: 300 },
{ name: "ダイヤモンド II", hours: 372 },
{ name: "ダイヤモンド III", hours: 476 },
{ name: "カーボナド", hours: 620 },
{ name: "パラゴン", hours: 1260 },
{ name: "オムニス", hours: 2540 }
];

// 保存済みデータ読み込み
let totalHours = parseFloat(localStorage.getItem("totalHours")) || 0;
let timerSeconds = parseInt(localStorage.getItem("timerSeconds")) || 0;
let timerRunning = false;
let interval = null;

// 時間加算
function addTime() {
    timerSeconds += 30 * 60;
    updateTimerDisplay();
    saveTimer();
}

// タイマー操作
function startTimer() {
    if (timerRunning) {
        clearInterval(interval);
        timerRunning = false;
    } else {
        timerRunning = true;
        interval = setInterval(() => {
            if (timerSeconds > 0) {
                timerSeconds--;
                updateTimerDisplay();
                saveTimer();
            } else {
                clearInterval(interval);
                timerRunning = false;
                // タイマー終了時に累計に加算
                totalHours += 0.5; // 30分刻み
                saveData();
                updateDisplay();
                alert("タイマー終了！累計時間に0.5h加算されました");
            }
        }, 1000);
    }
}

// タイマーリセット
function resetTimer() {
    clearInterval(interval);
    timerRunning = false;
    timerSeconds = 0;
    updateTimerDisplay();
    saveTimer();
}

// 累計リセット
function resetData() {
    totalHours = 0;
    saveData();
    updateDisplay();
}

// localStorage保存
function saveData() {
    localStorage.setItem("totalHours", totalHours);
}
function saveTimer() {
    localStorage.setItem("timerSeconds", timerSeconds);
}

// タイマー表示更新
function updateTimerDisplay() {
    let h = Math.floor(timerSeconds / 3600);
    let m = Math.floor((timerSeconds % 3600) / 60);
    let s = timerSeconds % 60;
    document.getElementById("timer").innerText =
        (h<10?"0":"")+h+":"+(m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}

// ランクとゲージ更新
function updateDisplay() {
    document.getElementById("totalHours").innerText = totalHours.toFixed(1);

    let currentRank = ranks[0];
    let nextRank = ranks[1];

    for (let i = 0; i < ranks.length; i++) {
        if (totalHours >= ranks[i].hours) {
            currentRank = ranks[i];
            nextRank = ranks[i + 1];
        }
    }

    document.getElementById("rank").innerText = currentRank.name;

    if (nextRank) {
        let remaining = (nextRank.hours - totalHours).toFixed(1);
        document.getElementById("nextRank").innerText = remaining;

        let progressPercent = ((totalHours - currentRank.hours) /
        (nextRank.hours - currentRank.hours)) * 100;

        document.getElementById("progressBar").style.width = progressPercent + "%";
    } else {
        document.getElementById("nextRank").innerText = "達成済み";
        document.getElementById("progressBar").style.width = "100%";
    }
}

// 初期表示
updateTimerDisplay();
updateDisplay();

</script>
</body>
</html>
